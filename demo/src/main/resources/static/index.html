<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Next-Gen Text Editor</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
        :root {
          --color-bg-light: #f0f2f5;
          --color-bg-dark: #121212;
          --color-text-light: #222;
          --color-text-dark: #eee;
          --color-accent: #0d6efd;
        }

        body {
          font-family: 'Inter', sans-serif;
          background-color: var(--color-bg-light);
          color: var(--color-text-light);
          transition: background-color 0.3s ease, color 0.3s ease;
          padding: 40px 20px;
        }

        body.dark {
          background-color: var(--color-bg-dark);
          color: var(--color-text-dark);
        }

        .editor-container {
          max-width: 900px;
          margin: auto;
          background: white;
          padding: 30px;
          border-radius: 12px;
          box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
          transition: background 0.3s ease, color 0.3s ease;
        }

        body.dark .editor-container {
          background: #1e1e1e;
          color: var(--color-text-dark);
        }

        textarea#editor {
          font-family: 'Courier New', monospace;
          resize: vertical;
          min-height: 220px;
          transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark textarea#editor {
          background-color: #2a2a2a;
          color: var(--color-text-dark);
          border-color: #444;
        }

        .btn-group .btn {
          min-width: 90px;
          transition: background-color 0.2s ease;
        }

        .btn:hover {
          filter: brightness(90%);
        }

        .header {
          margin-bottom: 30px;
          text-align: center;
          font-weight: 700;
          font-size: 2.5rem;
          color: var(--color-accent);
        }

        .toggle-dark {
          position: fixed;
          top: 20px;
          right: 20px;
        }

        /* Toast styling */
        #toast-container {
          position: fixed;
          bottom: 30px;
          right: 30px;
          z-index: 1080;
        }

    </style>
</head>
<body>

<button class="btn btn-outline-primary toggle-dark" id="darkModeToggle" title="Toggle Dark Mode">
    <i class="bi bi-moon-stars-fill"></i>
</button>

<div class="editor-container shadow-sm">
    <h1 class="header">Next-Gen Text Editor</h1>

    <textarea id="editor" class="form-control mb-4" readonly placeholder="Your text will appear here..."></textarea>

    <div class="row g-3 mb-3">
        <div class="col-md-8">
            <input type="text" id="inputText" class="form-control" placeholder="Type text to add" />
        </div>
        <div class="col-md-4 d-grid">
            <button class="btn btn-primary" onclick="addText()">Add Text</button>
        </div>
    </div>

    <div class="row g-3 mb-3">
        <div class="col-md-8">
            <input type="number" id="deleteCount" class="form-control" placeholder="Number of characters to delete" min="1" />
        </div>
        <div class="col-md-4 d-grid">
            <button class="btn btn-danger" onclick="deleteText()">Delete Text</button>
        </div>
    </div>

    <div class="mb-4 text-center">
        <div class="btn-group" role="group" aria-label="Undo and redo buttons">
            <button class="btn btn-outline-secondary" onclick="undo()">
                <i class="bi bi-arrow-counterclockwise"></i> Undo
            </button>
            <button class="btn btn-outline-secondary" onclick="redo()">
                <i class="bi bi-arrow-clockwise"></i> Redo
            </button>
        </div>
    </div>

    <div class="row g-3 mb-3">
        <div class="col-md-4">
            <input type="text" id="findText" class="form-control" placeholder="Find" />
        </div>
        <div class="col-md-4">
            <input type="text" id="replaceText" class="form-control" placeholder="Replace with" />
        </div>
        <div class="col-md-4 d-grid">
            <button class="btn btn-warning" onclick="findReplace()">Find & Replace</button>
        </div>
    </div>
</div>

<!-- Toast container -->
<div id="toast-container" aria-live="polite" aria-atomic="true"></div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Dark Mode Toggle
    const darkToggle = document.getElementById('darkModeToggle');
    darkToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      showToast(document.body.classList.contains('dark') ? 'Dark mode enabled' : 'Light mode enabled');
    });

    // Toast helper
    function showToast(message) {
      const toastContainer = document.getElementById('toast-container');
      const toastEl = document.createElement('div');
      toastEl.className = 'toast align-items-center text-bg-primary border-0';
      toastEl.role = 'alert';
      toastEl.ariaLive = 'assertive';
      toastEl.ariaAtomic = 'true';
      toastEl.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      `;
      toastContainer.appendChild(toastEl);

      const bsToast = new bootstrap.Toast(toastEl, { delay: 2000 });
      bsToast.show();

      toastEl.addEventListener('hidden.bs.toast', () => {
        toastEl.remove();
      });
    }

    async function refreshText() {
      const res = await fetch('/api/editor/text');
      const text = await res.text();
      document.getElementById('editor').value = text;
    }

    async function addText() {
      const newText = document.getElementById('inputText').value.trim();
      if (!newText) {
        showToast('Please enter text to add.');
        return;
      }
      await fetch('/api/editor/add?newText=' + encodeURIComponent(newText), { method: 'POST' });
      document.getElementById('inputText').value = '';
      refreshText();
      showToast('Text added!');
    }

    async function deleteText() {
      const count = document.getElementById('deleteCount').value;
      if (!count || count <= 0) {
        showToast('Please enter a valid number of characters to delete.');
        return;
      }
      await fetch('/api/editor/delete?count=' + count, { method: 'POST' });
      document.getElementById('deleteCount').value = '';
      refreshText();
      showToast(`Deleted last ${count} characters.`);
    }

    async function undo() {
      await fetch('/api/editor/undo', { method: 'POST' });
      refreshText();
      showToast('Undo performed.');
    }

    async function redo() {
      await fetch('/api/editor/redo', { method: 'POST' });
      refreshText();
      showToast('Redo performed.');
    }

    async function findReplace() {
      const find = document.getElementById('findText').value.trim();
      const replace = document.getElementById('replaceText').value.trim();
      if (!find) {
        showToast('Please enter text to find.');
        return;
      }
      await fetch(`/api/editor/findReplace?find=${encodeURIComponent(find)}&replace=${encodeURIComponent(replace)}`, { method: 'POST' });
      document.getElementById('findText').value = '';
      document.getElementById('replaceText').value = '';
      refreshText();
      showToast(`Replaced all occurrences of "${find}" with "${replace}".`);
    }

    // Initial load
    refreshText();
</script>

</body>
</html>
